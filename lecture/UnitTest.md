# 単体テスト仕様書の書き方

## 目的
* 単体テストのテストケースを洗い出す際の考え方やポイントを説明できる。

* 本研修で使用する単体テスト仕様書に沿ってテストケースを洗い出し、単体テスト仕様書を作成することができる。

***

# 第一部：テストケースの洗い出し

（何かを）詳しく念入りに調べて、テスト対象が設計の通りに出来上がっていることを確認するための項目を探し出す

「なにか」 → 関連するあらゆる設計書

**テストケースの原点は設計書である**

## 洗い出し方のポイント

単体テストを対象とする

テスト対象は？ → **実装者が作ったもの**  
部品として利用したものの機能は対象外となる ※機能の使い方に関してはテスト対象

確認内容は？ → 設計書に書いてあるすべての仕様
* 処理ロジック
* 画面の挙動
* 表示の出し分け
* 見た目

実施時期は？ → 実装に取り掛かる前  
テストケースは設計書を元に洗い出すのが基本  
モノがなくても洗い出し可能

## 例1 単純なプログラムを作成したとき

仕様

* 入力：2以上10以下の整数
* 出力：1から入力値までの整数の和
* 入力値が上記の範囲を超えた場合はIllegalArgumentExceptionをスローする

テストケースはおおよそいくつくらいになるだろうか？

* 入力仕様から洗い出し
  * 入力の最小値：2  
    →入力1の場合と2の場合を確認
  * 入力の最大値：10
    →入力10の場合と11の場合を確認

* 出力仕様から洗い出し
  1から入力値までの整数の和  
  →入力2, 10の場合を確認  
  →「入力仕様から洗い出し」ですでに出ている  
  →出力仕様から洗い出した結果、新しいケースはなかった

結果、テストケースは以下の4パターンである
* 入力：1　出力：IllegalArgumentException
* 入力：2　出力：3
* 入力：10　出力：55
* 入力：11　出力：IllegalArgumentException

上記の例は、テストケースの表現として不適切である

入力について  
入力の**条件**を記述する  
例) 最小値、最大値+1、入力範囲内の値

想定結果について  
テスト合格となる条件を記述する  
例) 1から入力値までの整数の和が出力される

なぜテストケースの記述では「条件」を書くの？  
→ 保守性（Java等の命名規則と同じ理由！）

***

## 例2 共通コンポーネントを使った単純なプログラムを作った時

正常呼び出し、異常呼び出しに関してテストすればよい

## 例3 画面入力項目に対するテストケース

システム機能設計書の記載

* 表示項目名：会員氏名（フリガナ）
* 表示イメージ：テキストボックスに入力
* 項目種類：テキストボックス
* 精査仕様
  * 文字種：全角カタカナのみ
  * 文字数：最大20文字
  * 必須
 
* 表示イメージから洗い出し
  表示イメージについては、ズバリ「その通りになっているか」
  入力：画面表示結果
  想定結果：会員氏名（フリガナ）について、システム機能設計書記載の表示イメージ通りである

* 項目種類から洗い出し

* 精査仕様から洗い出し  
  文字種　→　入力が「全角カタカナ」「それ以外」を確認  
  文字数　→　入力文字数が最大値、最大値+1を確認  
  必須　→　「何か入力する」「何も入力しない」を確認  
  「何か入力する」はすでに洗い出し済みなので、「何も入力しない」の1パターンを確認  
  * 全角カタカナ
  * 全角カタカナ以外
  * 精査エラーにならない文字種で、最大文字数を入力
  * 精査エラーにならない文字種で、最大文字数+1文字を入力
  * 何も入力しない

以上で十分か？  
残念！全然足りません！！！

画面表示に関連する設計書
* システム機能設計祖　←　当然
* UI標準（フォントなど）
* 方式設計書
* etc.

* UI標準から洗い出し
  * ラベルのフォントはMSゴシック 18ptとする
  * エラーメッセージのフォントはMSゴシック 18ptで赤字とする
  * 入力精査エラーが発生した場合、入力項目の直下に該当するエラーメッセージを表示する
  * 未入力の入力欄にはガイドとして入力例を表示する

* 方式設計書から洗い出し
  本システムで扱う入力文字種は以下の5種類
  半角英字、半角数字、全角ひらがな、全角カタカナ、全角漢字
  →　全角カタカナ以外を入力、ではまずい

漏れなくケースを洗い出すコツは、「一度に着目する観点は一つにする」こと

文字種精査エラー  
エラーが発生する文字種、表示位置やフォント、文言などをいっぺんに洗い出そうとせず、一つ一つ洗い出すことが大事

*** 

## 画面遷移に対するテストケース

名称：登録取引  
システム機能設計書の記載
* 登録確認画面では登録画面で入力された情報をラベルで表示
* 「登録確認」ボタン押下の際には精査を実行し、エラーがあれば登録画面に戻る
* 「戻る」ボタン押下の際には登録画面に入力値を復元する
* 「登録する」ボタン押下の際には入力値をDBへ登録する

画面遷移にはいくつかのパターンがある  
例）正常遷移、戻る遷移、異常遷移...

今回は正常遷移のパターンを考える


### 考え方

画面遷移をテストしたい！　→設計通り画面が遷移することを確認  
画面のレイアウトや精査処理などは**対象外**  
一方、複数画面にまたがる処理（値が引き継がれるか等）は確認対象

主に画面遷移図を参照しながら洗い出す

ケースの入力は「どんな画面操作をするか」

テストすべき画面遷移は以下の通り  
登録画面→登録確認画面→登録完了画面→メインメニュー

### ケースの洗い出し
システム機能設計書の記載から洗い出す
* 登録確認画面では登録画面で入力された情報をラベルで表示  
  →画面をまたがって情報のやり取りが発生する処理なので確認が必要
* 「登録確認」ボタン押下の際には精査を実行し、エラーがあれば登録画面に戻る  
  →今回、正常遷移を考えているので考慮不要
* 「戻る」ボタン押下の際には登録画面に入力値を復元する  
  →今回、正常遷移を考えているので考慮不要
* 「登録する」ボタン押下の際には入力値をDBへ登録する  
  →画面遷移していく中で発生する処理なので、確認する

***

# 単体テスト仕様書の作成

単体テスト標準を、ケース抽出の前に必ず熟読しておく

テスト観点：先人の知恵をリストにして文書化したもの

作成手順
1. 各確認観点について、要不要を検討
2. 必要と判断した確認観点ごとに以下を繰り返してケース作成
   1. 何をテストするか、どういう風に操作するか検討
   2. 「テスト内容」欄に記入
   3. テスト内容を実行したら、どういう風になるべきか検討
   4. 「想定結果」欄に記入
